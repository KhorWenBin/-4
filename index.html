<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åƒåœ¾åˆ†ç±»æŒ‘æˆ˜ (ä¸¥æ ¼ç‰ˆ)</title>
    <style>
        /* åŸºç¡€è®¾ç½® */
        body {
            margin: 0;
            padding: 0;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            background-color: #f0f4f8;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            touch-action: none;
        }

        /* å¤´éƒ¨è®¡åˆ†æ¿ */
        header {
            width: 100%;
            padding: 15px 20px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: bold;
            box-sizing: border-box;
            z-index: 10;
        }

        .score-box { color: #2c3e50; }
        .remaining-box { color: #7f8c8d; font-size: 0.9rem; display: flex; align-items: center; }

        /* æ¸¸æˆä¸»åŒºåŸŸ */
        #game-area {
            flex: 1;
            width: 100%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* å¾…åˆ†ç±»çš„åƒåœ¾é¡¹ */
        #trash-item {
            width: 110px;
            height: 110px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: grab;
            position: absolute;
            z-index: 100;
            transition: transform 0.1s;
            user-select: none;
            border: 4px solid white;
        }

        #trash-item.dragging {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            cursor: grabbing;
            z-index: 1000; /* æ‹–æ‹½æ—¶å±‚çº§æœ€é«˜ */
        }

        #trash-item .emoji { font-size: 45px; margin-bottom: 5px; }
        #trash-item .name { font-size: 15px; color: #555; font-weight: bold; pointer-events: none; }

        /* åƒåœ¾æ¡¶åŒºåŸŸ */
        #bins-container {
            width: 100%;
            height: 180px;
            display: flex;
            justify-content: space-around;
            padding-bottom: 20px;
            box-sizing: border-box;
            background: white;
            border-top: 1px solid #eee;
        }

        .bin {
            width: 23%;
            height: 100%;
            border-radius: 15px 15px 0 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            transition: transform 0.2s;
            position: relative;
        }

        .bin span { font-size: 32px; margin-bottom: 8px; }
        .bin div { font-size: 14px; text-align: center; line-height: 1.4; }

        /* åƒåœ¾æ¡¶é¢œè‰²å®šä¹‰ */
        .bin-wet { background-color: #6c5b4c; border-bottom: 6px solid #504136; }
        .bin-dry { background-color: #2c3e50; border-bottom: 6px solid #1a252f; }
        .bin-recycle { background-color: #0056b3; border-bottom: 6px solid #003d80; }
        .bin-harmful { background-color: #e74c3c; border-bottom: 6px solid #c0392b; }

        .bin.hovered { transform: scale(1.05) translateY(-10px); opacity: 0.9; }

        /* æ­£ç¡®åé¦ˆæç¤º */
        #feedback {
            position: absolute;
            top: 15%;
            font-size: 4rem;
            font-weight: bold;
            opacity: 0;
            pointer-events: none;
            z-index: 200;
            transition: opacity 0.3s, transform 0.3s;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        /* --- é”™è¯¯æç¤ºçº¢ç›’å­ (æ–°å¢) --- */
        #error-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #e74c3c; /* é²œçº¢è‰²èƒŒæ™¯ */
            z-index: 9999; /* è¦†ç›–ä¸€åˆ‡ */
            display: none; /* é»˜è®¤éšè— */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        #error-modal h2 { font-size: 3rem; margin: 0 0 20px 0; text-shadow: 2px 2px 0 rgba(0,0,0,0.2); }
        #error-modal .error-icon { font-size: 80px; margin-bottom: 20px; }
        #error-modal .error-desc { font-size: 1.5rem; margin-bottom: 30px; line-height: 1.5; }
        #error-modal .correct-answer { 
            background: rgba(0,0,0,0.2); 
            padding: 10px 20px; 
            border-radius: 10px; 
            font-weight: bold;
            font-size: 1.8rem;
        }
        #error-modal .timer { 
            margin-top: 40px; 
            font-size: 1rem; 
            opacity: 0.8;
            border: 2px solid white;
            width: 40px;
            height: 40px;
            line-height: 40px;
            border-radius: 50%;
        }

    </style>
</head>
<body>

<header>
    <div class="score-box">å¾—åˆ†: <span id="score">0</span></div>
    <div class="remaining-box">å‰©ä½™ç‰©å“: <span id="remaining-count">0</span></div>
</header>

<div id="game-area">
    <div id="feedback"></div>
    <div id="trash-item">
        <div class="emoji">ğŸ</div>
        <div class="name">è‹¹æœæ ¸</div>
    </div>
</div>

<div id="bins-container">
    <div class="bin bin-wet" data-type="wet" data-name="æ¹¿åƒåœ¾">
        <span>ğŸ¥¬</span>
        <div>æ¹¿åƒåœ¾<br>(å¨ä½™)</div>
    </div>
    <div class="bin bin-dry" data-type="dry" data-name="å¹²åƒåœ¾">
        <span>ğŸ§»</span>
        <div>å¹²åƒåœ¾<br>(å…¶ä»–)</div>
    </div>
    <div class="bin bin-recycle" data-type="recycle" data-name="å¯å›æ”¶ç‰©">
        <span>ğŸ“¦</span>
        <div>å¯å›æ”¶ç‰©</div>
    </div>
    <div class="bin bin-harmful" data-type="harmful" data-name="æœ‰å®³åƒåœ¾">
        <span>ğŸ”‹</span>
        <div>æœ‰å®³åƒåœ¾</div>
    </div>
</div>

<div id="error-modal">
    <div class="error-icon">âŒ</div>
    <h2>é€‰é”™äº†!</h2>
    <div class="error-desc">
        <span id="error-item-name">è‹¹æœæ ¸</span> å…¶å®æ˜¯ï¼š
    </div>
    <div class="correct-answer" id="error-correct-bin">æ¹¿åƒåœ¾</div>
    <div class="timer" id="countdown">5</div>
</div>

<script>
    // æ¸¸æˆåŸå§‹æ•°æ®
    const masterTrashData = [
        { name: "è‹¹æœæ ¸", icon: "ğŸ", type: "wet" },
        { name: "å‰©é¥­å‰©èœ", icon: "ğŸ›", type: "wet" },
        { name: "è¥¿ç“œçš®", icon: "ğŸ‰", type: "wet" },
        { name: "é±¼éª¨å¤´", icon: "ğŸŸ", type: "wet" },
        { name: "èŒ¶å¶æ¸£", icon: "ğŸµ", type: "wet" },
        { name: "æ±¡æŸçº¸å·¾", icon: "ğŸ§»", type: "dry" },
        { name: "çƒŸè’‚", icon: "ğŸš¬", type: "dry" },
        { name: "ä¸€æ¬¡æ€§æ¯", icon: "ğŸ¥¤", type: "dry" },
        { name: "æ©¡çš®æ³¥", icon: "ğŸ§¶", type: "dry" },
        { name: "çŸ¿æ³‰æ°´ç“¶", icon: "ğŸ§´", type: "recycle" },
        { name: "æ˜“æ‹‰ç½", icon: "ğŸ¥«", type: "recycle" },
        { name: "æ—§æŠ¥çº¸", icon: "ğŸ“°", type: "recycle" },
        { name: "å¿«é€’çº¸ç®±", icon: "ğŸ“¦", type: "recycle" },
        { name: "åºŸç”µæ± ", icon: "ğŸ”‹", type: "harmful" },
        { name: "è¿‡æœŸè¯å“", icon: "ğŸ’Š", type: "harmful" },
        { name: "æ°´é“¶æ¸©åº¦è®¡", icon: "ğŸŒ¡ï¸", type: "harmful" },
        { name: "æ€è™«å‰‚", icon: "ğŸ¦Ÿ", type: "harmful" }
    ];

    // è¿è¡Œæ—¶å˜é‡
    let gamePool = []; // å½“å‰è½®æ¬¡çš„æŠ½é¢˜æ± 
    let currentTrash = null;
    let score = 0;
    
    // DOM å…ƒç´ 
    const trashElement = document.getElementById('trash-item');
    const scoreEl = document.getElementById('score');
    const remainingEl = document.getElementById('remaining-count');
    const feedbackEl = document.getElementById('feedback');
    const bins = document.querySelectorAll('.bin');
    const errorModal = document.getElementById('error-modal');
    const errorItemName = document.getElementById('error-item-name');
    const errorCorrectBin = document.getElementById('error-correct-bin');
    const countdownEl = document.getElementById('countdown');

    // åƒåœ¾æ¡¶åç§°æ˜ å°„
    const binNames = {
        'wet': 'æ¹¿åƒåœ¾ (å¨ä½™)',
        'dry': 'å¹²åƒåœ¾ (å…¶ä»–)',
        'recycle': 'å¯å›æ”¶ç‰©',
        'harmful': 'æœ‰å®³åƒåœ¾'
    };

    function initGame() {
        refillPool();
        spawnTrash();
        setupEvents();
    }

    // å¡«å……æŠ½é¢˜æ± å¹¶æ´—ç‰Œ
    function refillPool() {
        // å¤åˆ¶ä¸€ä»½å®Œæ•´æ•°æ®
        gamePool = JSON.parse(JSON.stringify(masterTrashData));
        // éšæœºæ‰“ä¹± (Fisher-Yates Shuffle)
        for (let i = gamePool.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [gamePool[i], gamePool[j]] = [gamePool[j], gamePool[i]];
        }
    }

    function spawnTrash() {
        // å¦‚æœæ± å­ç©ºäº†ï¼Œé‡æ–°å¼€å§‹ä¸€è½®
        if (gamePool.length === 0) {
            alert("ğŸ‰ æ­å–œï¼æ‰€æœ‰ç‰©å“åˆ†ç±»å®Œæˆï¼å³å°†å¼€å§‹æ–°çš„ä¸€è½®ã€‚");
            refillPool();
        }

        // ä»æ± å­æœ«å°¾å–å‡ºä¸€ä¸ªï¼ˆä¸é‡å¤çš„æ ¸å¿ƒé€»è¾‘ï¼‰
        currentTrash = gamePool.pop();
        
        // æ›´æ–°ç•Œé¢
        trashElement.querySelector('.emoji').textContent = currentTrash.icon;
        trashElement.querySelector('.name').textContent = currentTrash.name;
        remainingEl.textContent = gamePool.length;
        
        resetTrashPosition();
    }

    function resetTrashPosition() {
        trashElement.style.display = 'flex';
        trashElement.style.transition = 'transform 0.3s ease-out';
        trashElement.style.transform = 'translate(0, 0)';
        trashElement.style.left = '50%';
        trashElement.style.top = '40%'; // ç¨å¾®é ä¸Šä¸€ç‚¹
        trashElement.style.marginLeft = '-55px';
        trashElement.style.marginTop = '-55px';
        
        setTimeout(() => {
            trashElement.style.transition = 'none';
        }, 300);
    }

    // --- è§¦æ‘¸é€»è¾‘ (ä¸ä¹‹å‰ç›¸åŒï¼Œä¿æŒæµç•…ä½“éªŒ) ---
    let isDragging = false;
    let startX, startY;

    function setupEvents() {
        trashElement.addEventListener('touchstart', handleStart, {passive: false});
        trashElement.addEventListener('touchmove', handleMove, {passive: false});
        trashElement.addEventListener('touchend', handleEnd);
        
        trashElement.addEventListener('mousedown', handleStart);
        document.addEventListener('mousemove', handleMove);
        document.addEventListener('mouseup', handleEnd);
    }

    function handleStart(e) {
        e.preventDefault();
        isDragging = true;
        trashElement.classList.add('dragging');
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        const rect = trashElement.getBoundingClientRect();
        startX = clientX - rect.left;
        startY = clientY - rect.top;
    }

    function handleMove(e) {
        if (!isDragging) return;
        e.preventDefault();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        
        trashElement.style.position = 'fixed';
        trashElement.style.left = (clientX - startX) + 'px';
        trashElement.style.top = (clientY - startY) + 'px';
        trashElement.style.margin = 0;
        trashElement.style.transform = 'scale(1.1)';

        checkCollision(clientX, clientY);
    }

    function handleEnd(e) {
        if (!isDragging) return;
        isDragging = false;
        trashElement.classList.remove('dragging');

        const rect = trashElement.getBoundingClientRect();
        const targetBin = getTargetBin(rect.left + rect.width/2, rect.top + rect.height/2);

        if (targetBin) {
            checkAnswer(targetBin.dataset.type);
        } else {
            resetTrashPosition();
        }
        bins.forEach(b => b.classList.remove('hovered'));
    }

    function checkCollision(x, y) {
        bins.forEach(bin => {
            const rect = bin.getBoundingClientRect();
            if (x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom) {
                bin.classList.add('hovered');
            } else {
                bin.classList.remove('hovered');
            }
        });
    }

    function getTargetBin(x, y) {
        let target = null;
        bins.forEach(bin => {
            const rect = bin.getBoundingClientRect();
            if (x >= rect.left && x <= rect.right && y >= rect.top) {
                target = bin;
            }
        });
        return target;
    }

    // --- åˆ¤å®šé€»è¾‘ (å«é”™è¯¯å¤„ç†) ---
    function checkAnswer(binType) {
        if (binType === currentTrash.type) {
            // æ­£ç¡®
            score += 10;
            scoreEl.textContent = score;
            showFeedback("âœ… æ­£ç¡®!", "#2ecc71");
            if(navigator.vibrate) navigator.vibrate(50);
            
            // éšè—æ—§çš„ï¼Œå‡†å¤‡ç”Ÿæˆæ–°çš„
            trashElement.style.display = 'none';
            setTimeout(() => {
                spawnTrash();
            }, 500);
        } else {
            // é”™è¯¯ -> è§¦å‘çº¢è‰²æ ¼å­
            triggerErrorState();
        }
    }

    function showFeedback(text, color) {
        feedbackEl.textContent = text;
        feedbackEl.style.color = color;
        feedbackEl.style.opacity = 1;
        feedbackEl.style.transform = 'scale(1.2)';
        setTimeout(() => {
            feedbackEl.style.opacity = 0;
            feedbackEl.style.transform = 'scale(1)';
        }, 1000);
    }

    // é”™è¯¯å¤„ç†é€»è¾‘
    function triggerErrorState() {
        if(navigator.vibrate) navigator.vibrate(200);
        
        // 1. è®¾ç½®é”™è¯¯ä¿¡æ¯
        errorItemName.textContent = currentTrash.name;
        errorCorrectBin.textContent = binNames[currentTrash.type];
        
        // 2. æ˜¾ç¤ºçº¢ç›’å­
        errorModal.style.display = 'flex';
        
        // 3. å€’è®¡æ—¶é€»è¾‘
        let timeLeft = 5;
        countdownEl.textContent = timeLeft;
        
        const timer = setInterval(() => {
            timeLeft--;
            countdownEl.textContent = timeLeft;
            if (timeLeft <= 0) {
                clearInterval(timer);
                // æ—¶é—´åˆ°ï¼Œéšè—å¼¹çª—ï¼Œè¿›å…¥ä¸‹ä¸€é¢˜
                errorModal.style.display = 'none';
                // é”™è¯¯ä¸åŠ åˆ†ï¼Œç›´æ¥ä¸‹ä¸€é¢˜
                spawnTrash();
            }
        }, 1000);
    }

    initGame();

</script>
</body>
</html>